@use "sass:color";
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800&family=Open+Sans:wght@400;500;600;700&display=swap');

$imported-fonts: true;

.dashboard-loading {
  padding: 60px;
  font-size: 1.2rem;
  text-align: center;
}

$brand-from: #F18585;
$brand-to: #C174F2;
$bg-deep: #0f1426;
$bg-alt: #10192e;
$bg-alt2: #0e1729;
$bg-alt3: #142033; // nuance supplémentaire
$light-surface: #f2f4f8;
$light-surface-alt: #e8ecf2;
$border-col: rgba(255,255,255,0.08);
$text-col: #fff;
$muted: rgba(255,255,255,.72);

.admin-dashboard {
  display: grid;
  grid-template-columns: 250px 1fr;
  min-height: 100vh;
  background: linear-gradient(135deg, $bg-deep, $bg-alt2 70%);
  color: $text-col;
  font-family: 'Open Sans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  position: relative;
}

// Police titres
.admin-dashboard h1,
.admin-dashboard h2,
.admin-dashboard h3,
.admin-dashboard h4,
.admin-dashboard h5,
.admin-dashboard .brand,
.admin-dashboard .nav-sections button .lbl,
.admin-dashboard .count-badge {
  font-family: 'Montserrat', 'Open Sans', system-ui, sans-serif;
  font-weight: 600;
  letter-spacing: .5px;
}

// Ajustements poids/tailles spécifiques
.admin-dashboard h1 { font-weight: 700; }
.admin-dashboard h2 { font-weight: 600; }
.admin-dashboard .nav-sections button { font-weight: 600; }
.admin-dashboard .count-badge { font-weight: 700; }

.sidebar {
  background: linear-gradient(180deg, $brand-from, $brand-to 85%);
  border-right: 1px solid rgba(255,255,255,0.12);
  padding: 24px 20px 18px;
  display: flex;
  flex-direction: column;
  gap: 26px;
  box-shadow: 0 0 20px -4px rgba(0,0,0,.35);
  position: sticky;
  top: 0;
  height: 100vh;
  overflow-y: auto;
}

.sidebar .brand {
  font-size: 1.15rem;
  font-weight: 600;
  letter-spacing: .5px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}
.close-btn {
  background: rgba(255,255,255,0.18);
  border: 1px solid rgba(255,255,255,0.3);
  color:#fff;
  width:34px;
  height:34px;
  border-radius:10px;
  cursor:pointer;
  font-size:16px;
  line-height:1;
  display:none; /* visible seulement mobile */
  transition: background .2s, transform .18s;
}
.close-btn:hover { background: rgba(255,255,255,0.28); transform: translateY(-2px); }

.user-box {
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.25);
  padding: 12px 14px;
  border-radius: 14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-size: .78rem;
  box-shadow: 0 4px 14px -4px rgba(0,0,0,.4);
}
.user-box .u-email { font-weight: 500; word-break: break-all; }
.user-box .u-role {
  align-self: flex-start;
  background: #0063cc;
  padding: 3px 10px 4px;
  border-radius: 14px;
  text-transform: uppercase;
  font-size: .6rem;
  letter-spacing: .5px;
}

.nav-sections ul {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.nav-sections button {
  width: 100%;
  background: rgba(255,255,255,0.14);
  border: 1px solid rgba(255,255,255,0.22);
  color: #fff;
  padding: 10px 12px;
  border-radius: 12px;
  display: flex;
  gap: 10px;
  align-items: center;
  cursor: pointer;
  font-size: .8rem;
  font-weight: 600;
  letter-spacing: .4px;
  transition: background .22s, transform .16s, box-shadow .22s;
  backdrop-filter: blur(2px);
}
.nav-sections button .ico { font-size: 1.05rem; }
.nav-sections button.active,
.nav-sections button:hover {
  background: #fff;
  color: #121212;
  box-shadow: 0 6px 18px -6px rgba(0,0,0,.45);
  transform: translateY(-2px);
}

.logout-btn-full {
  margin-top: auto;
  background: linear-gradient(135deg, #ff6666, #ff2f2f);
  border: 1px solid rgba(255,255,255,0.3);
  color: #fff;
  padding: 12px 16px;
  border-radius: 14px;
  cursor: pointer;
  font-size: .75rem;
  font-weight: 700;
  letter-spacing: .6px;
  text-transform: uppercase;
  transition: filter .25s, transform .18s;
  box-shadow: 0 6px 18px -6px rgba(0,0,0,.55);
}
.logout-btn-full:hover { filter: brightness(1.08); transform: translateY(-2px); }
.logout-btn-full:active { transform: translateY(0); }

.main-panel {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background: linear-gradient(180deg,$light-surface 0%,$light-surface-alt 120%);
  color: #1d2a3b;
}
.panel-header {
  padding: 20px 30px 6px;
  display: flex;
  align-items: center;
  gap: 14px;
}
.panel-header h1 { margin:0; font-size:1.55rem; letter-spacing:.5px; }
.menu-toggle {
  display: none;
  background: linear-gradient(135deg,$brand-from,$brand-to);
  color: #fff;
  border: 1px solid rgba(255,255,255,0.35);
  border-radius: 10px;
  padding: 8px 12px;
  font-size: 1rem;
  cursor: pointer;
  box-shadow: 0 4px 14px -4px rgba(0,0,0,.5);
  transition: filter .2s, transform .15s;
}
.menu-toggle:hover { filter: brightness(1.08); transform: translateY(-1px); }
.panel-content {
  /* Padding fluide et recentré */
  padding: clamp(12px,2.5vw,28px) clamp(16px,4vw,48px) 50px;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 32px;
  width: 100%;
  max-width: 1320px; /* largeur cible proche header contenu */
  margin: 0 auto;     /* centrage */
  box-sizing: border-box;
  min-width: 0;       /* évite overflow flex */
}

// Listes génériques
.list-wrapper { display:flex; flex-direction:column; gap:16px; }
.list-header { display:flex; align-items:center; gap:12px; }
.list-header h2 { margin:0; font-size:1.1rem; }
.count-badge { background:rgba(255,255,255,0.12); padding:4px 10px; border-radius:20px; font-size:.7rem; letter-spacing:.5px; }
.generic-list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; border:1px solid rgba(255,255,255,.08); border-radius:18px; overflow:hidden; backdrop-filter: blur(2px); }
.generic-list li { padding:12px 18px 14px; display:flex; flex-direction:column; gap:4px; background:linear-gradient(135deg,rgba(255,255,255,0.06),rgba(255,255,255,0.02)); }
.generic-list li:nth-child(odd) { background:linear-gradient(135deg,rgba(255,255,255,0.09),rgba(255,255,255,0.03)); }
.generic-list li + li { border-top:1px solid rgba(255,255,255,0.08); }
.generic-list .primary { font-size:.83rem; font-weight:600; letter-spacing:.35px; }
.generic-list .secondary { font-size:.68rem; opacity:.74; line-height:1.2; }
.empty { font-size:.8rem; opacity:.7; }
.section-loading, .section-error, .inline-loading { font-size:.8rem; }
.section-error { color:#ff8b7a; }

// ==========================
// Tableau CRUD (sections)
// ==========================
.table-wrapper { display:flex; flex-direction:column; gap:14px; }
.table-toolbar { display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap; }
.table-toolbar .ttl { font-weight:600; font-family:'Montserrat',sans-serif; font-size:1rem; letter-spacing:.4px; display:flex; align-items:center; gap:10px; }

.table-scroll { width:100%; overflow:auto; background:#fff; border:1px solid #d9e1ea; border-radius:14px; box-shadow:0 4px 12px -6px rgba(0,0,0,.1); -webkit-overflow-scrolling:touch; }

table.data-table { width:100%; border-collapse:collapse; font-size:.78rem; }
table.data-table thead { background:linear-gradient(90deg,#f7f9fb,#f0f4f8); text-align:left; }
table.data-table th, table.data-table td { padding:10px 14px; white-space:nowrap; font-weight:500; }
table.data-table th { font-size:.7rem; text-transform:uppercase; letter-spacing:.6px; font-weight:700; color:#31455b; }
table.data-table tbody tr { background:#fff; transition:background .18s; }
table.data-table tbody tr:nth-child(odd) { background:#fafcfd; }
table.data-table tbody tr:hover { background:#eef5ff; }
table.data-table tbody tr + tr { border-top:1px solid #e2e8ef; }
table.data-table td { font-weight:400; color:#2a3848; }
table.data-table td.actions { display:flex; gap:6px; align-items:center; }

// Retirer les lignes verticales – uniquement des séparateurs horizontaux
table.data-table { border:0; }
table.data-table th + th, table.data-table td + td { border-left:0; }

// Badges dans le tableau (réutilisation)
table.data-table .badge { background:#e6eef9; color:#284b75; padding:2px 8px 3px; border-radius:10px; font-size:.55rem; font-weight:600; letter-spacing:.5px; }

// Boutons génériques
.btn { border:0; cursor:pointer; font-family:'Montserrat',sans-serif; font-weight:600; letter-spacing:.4px; line-height:1; display:inline-flex; align-items:center; gap:6px; }
.btn:disabled { opacity:.5; cursor:not-allowed; }
.btn.primary { background:linear-gradient(135deg,$brand-from,$brand-to); color:#fff; padding:10px 16px; border-radius:10px; font-size:.7rem; box-shadow:0 4px 12px -6px rgba(0,0,0,.4); transition:filter .2s, transform .18s; }
.btn.primary:hover { filter:brightness(1.06); transform:translateY(-2px); }
.btn.primary:active { transform:translateY(0); }
.btn.sm { background:#ffffff; border:1px solid #ced8e2; color:#2a3a4b; padding:6px 10px; border-radius:8px; font-size:.65rem; box-shadow:0 2px 6px -2px rgba(0,0,0,.15); transition:background .2s, transform .15s; }
.btn.sm:hover { background:#f1f5f9; transform:translateY(-2px); }
.btn.sm:active { transform:translateY(0); }
.btn.danger { background:linear-gradient(135deg,#ff6767,#ff2c2c); color:#fff; border:1px solid #ff8f8f; }
.btn.danger:hover { filter:brightness(1.05); }

// Ajustement dans panneau clair
.main-panel .count-badge { background:#e8eff5; color:#2a3a4b; }

@media (max-width: 720px) {
  .panel-content { padding: clamp(10px,3vw,20px) clamp(12px,3.5vw,26px) 42px; }
  table.data-table th, table.data-table td { padding:8px 10px; }
  .table-toolbar .ttl { font-size:.9rem; }
  .btn.primary { padding:9px 14px; }
}

@media (max-width: 1100px) {
  .panel-content { padding-left: clamp(14px,3vw,30px); padding-right: clamp(14px,3vw,30px); max-width: 1000px; }
}

@media (max-width: 860px) {
  table.data-table th, table.data-table td { white-space: normal; }
  table.data-table th, table.data-table td { padding:8px 10px; }
  .table-scroll { overflow-x: auto; }
  .table-wrapper { gap:10px; }
}

@media (max-width: 560px) {
  table.data-table { table-layout: auto; }
  table.data-table th, table.data-table td { font-size:.66rem; }
  .table-toolbar .ttl { font-size:.8rem; }
  .btn.sm { font-size:.6rem; padding:5px 8px; }
}

@media (max-width: 420px) {
  .panel-content { padding-left:12px; padding-right:12px; }
  table.data-table th, table.data-table td { padding:6px 8px; }
}

.cards-grid { grid-template-columns: repeat(auto-fill,minmax(250px,1fr)); }
.card { 
  min-height: 160px; 
  background: linear-gradient(150deg,$bg-alt,$bg-alt2 60%,$bg-alt3 100%); 
  color: #fff; 
  border:1px solid rgba(255,255,255,0.08);
}
.overview-grid { 
  display:grid; 
  gap:28px; 
  grid-template-columns: 340px 1fr; /* Colonne gauche (cartes), droite (graphes) */
  justify-content: stretch; 
  align-items:stretch; /* égalise les hauteurs par ligne */
  margin-inline:auto; 
  width:100%;
  max-width: 1400px;
}
/* Shimmer placeholders (lighter & subtle) */
.overview-loading .card {
  background: linear-gradient(120deg, rgba(255,255,255,0.35) 0%, rgba(255,255,255,0.18) 38%, rgba(255,255,255,0.32) 72%);
  position: relative;
  overflow: hidden;
}
.overview-loading .card::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(100deg, transparent 0%, rgba(255,255,255,0.55) 50%, transparent 100%);
  animation: shimmer 1.6s infinite;
  opacity: .55;
}
@keyframes shimmer { from { transform: translateX(-100%); } to { transform: translateX(100%); } }
// Lighter cards aligned with brand gradient
.overview-grid .card { 
  // Updated to use color.adjust instead of deprecated lighten()
  background: linear-gradient(
    135deg,
    color.adjust($brand-from, $lightness: 15%),
    color.adjust($brand-to, $lightness: 5%)
  );
  color:#1d2a3b; 
  position:relative; 
  border:1px solid rgba(0,0,0,0.06); 
  box-shadow:0 10px 26px -10px rgba(0,0,0,.18), 0 4px 10px -4px rgba(0,0,0,.12);
  backdrop-filter: blur(4px);
}
.overview-grid .card h2, .overview-grid .card h3 { color:#1a2533; }
.overview-grid .card .kv-list li { background:rgba(255,255,255,0.55); }
.overview-grid .kv-list li .k { color:#1d2a3b; }
.overview-grid .kv-list li .v { color:#25374a; }
.overview-grid .counts-list { display:flex; flex-wrap:wrap; gap:10px; margin-top:8px; }
.overview-grid .count-pill { background:rgba(255,255,255,0.75); border:1px solid rgba(0,0,0,0.08); padding:10px 14px; border-radius:14px; display:flex; flex-direction:column; gap:6px; min-width:110px; box-shadow:0 4px 10px -4px rgba(0,0,0,.15); }
.overview-grid .count-pill .lbl { font-size:.58rem; text-transform:uppercase; letter-spacing:.55px; opacity:.75; font-weight:600; color:#2a3c52; }
.overview-grid .count-pill .val { font-size:1.25rem; font-weight:700; font-family:'Montserrat',sans-serif; color:#1d2a3b; line-height:1; }
.overview-grid .chart-card { padding:18px 18px 22px; }
/* Les cartes graphiques occupent la colonne de droite */
.overview-grid .chart-card { grid-column: 2; }
/* Retrait de l'ancien span complet */
.overview-grid .large-chart { grid-column: 2; }
.overview-grid .card { min-height: 220px; padding:26px 24px 30px; }
.overview-grid .profile-card { min-height:240px; }
.overview-grid .counts-card { min-height:240px; }
/* Agrandissement spécifique des lignes dans la carte Profil */
.overview-grid .profile-card .kv-list li { 
  font-size:.8rem; 
  padding:10px 14px; 
  line-height:1.25; 
}
.overview-grid .profile-card .kv-list li .k { 
  font-size:.78rem; 
  letter-spacing:.5px; 
}
.overview-grid .profile-card .kv-list li .v { 
  font-size:.82rem; 
  max-width:60%; 
}
/* Remplissage hauteur pour cartes de gauche afin d'égaler cartes graphiques */
.overview-grid .pair-fill { height:100%; display:flex; flex-direction:column; }
.overview-grid .pair-fill h2 { margin-top:0; }
.overview-grid .pair-fill .counts-list { flex:1; display:flex; flex-wrap:wrap; align-content:flex-start; }
@media (max-width:1100px){
  .overview-grid { grid-template-columns: 300px 1fr; }
}
@media (max-width:900px){
  /* Empilage sur mobile/tablette */
  .overview-grid { grid-template-columns: 1fr; }
  .overview-grid .chart-card { grid-column: 1; }
  .overview-grid .large-chart { grid-column: 1; }
}
@media (min-width:1600px){ .overview-grid { grid-template-columns: repeat(auto-fit,minmax(340px, 360px)); } .overview-grid .large-chart { grid-column: span 2; } }
.overview-grid .chart-card h3 { margin:0 0 10px; font-size:.85rem; letter-spacing:.5px; font-weight:600; font-family:'Montserrat',sans-serif; }
.overview-grid .profile-card { min-width:260px; }
.overview-grid .counts-card { min-width:240px; }
.overview-grid .recharts-default-tooltip { font-size:.65rem; }
.overview-grid .recharts-legend-item { font-size:.6rem; }

@media (max-width:760px) {
  .overview-grid { grid-template-columns: 1fr; }
}
.card p, .card li { color: rgba(255,255,255,.85); }
.kv-list { list-style:none; margin:8px 0 0; padding:0; display:flex; flex-direction:column; gap:6px; }
.kv-list li { display:flex; justify-content:space-between; align-items:center; font-size:.72rem; background:rgba(255,255,255,0.05); padding:6px 10px; border-radius:8px; }
.kv-list li .k { font-weight:700; letter-spacing:.4px; font-family:'Montserrat',sans-serif; margin-right:14px; flex: 0 0 auto; }
.kv-list li .v { font-weight:500; font-family:'Open Sans',sans-serif; max-width:55%; text-align:right; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
@media (max-width: 520px) { .kv-list li { font-size:.68rem; } .kv-list li .v { max-width:50%; } }
.card h2 { font-size: 1rem; }
.card details summary { font-size:.7rem; }

@media (max-width: 1000px) {
  .admin-dashboard { grid-template-columns: 220px 1fr; }
}
@media (max-width: 820px) {
  .admin-dashboard { grid-template-columns: 1fr; }
  .sidebar { 
    position: fixed; 
    left: 0; 
  top: var(--global-header-height, 70px);
    width:250px; 
    height:100vh; 
    transform: translateX(-110%);
    transition: transform .32s cubic-bezier(.4,.0,.2,1); 
    z-index: 60; 
    padding-top: max(16px, env(safe-area-inset-top));
  }
  .sidebar.open { transform: translateX(0); }
  .sidebar .brand .close-btn { display:inline-flex; align-items:center; justify-content:center; }
  .user-box { display:flex; }
  .sidebar-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.45);
    backdrop-filter: blur(2px);
    z-index: 55;
    animation: fadeIn .3s ease;
  }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
  .menu-toggle { display: inline-flex; }
  .panel-header { padding:16px 18px 4px; }
  .panel-content { padding:14px 18px 40px; }
}
/* Chip utilisateur dans le header principal (mobile) */
.mobile-user-chip { display:none; margin-left:auto; align-items:center; gap:10px; background:linear-gradient(135deg,$brand-from,$brand-to); padding:6px 12px; border-radius:14px; box-shadow:0 4px 12px -4px rgba(0,0,0,.4); }
.mobile-user-chip .email { font-size:.6rem; max-width:110px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-weight:600; }
.mobile-user-chip .role { background:rgba(255,255,255,0.18); padding:2px 8px 3px; border-radius:10px; font-size:.55rem; text-transform:uppercase; letter-spacing:.6px; }
.mobile-user-chip .mini-logout { background:rgba(255,255,255,0.18); border:1px solid rgba(255,255,255,0.35); color:#fff; border-radius:8px; padding:4px 6px; cursor:pointer; font-size:.65rem; line-height:1; transition:background .2s, transform .18s; }
.mobile-user-chip .mini-logout:hover { background:rgba(255,255,255,0.28); transform:translateY(-2px); }

@media (max-width: 820px) {
  .mobile-user-chip { display:inline-flex; }
}
@media (max-width: 480px) {
  .mobile-user-chip .email { max-width:78px; }
}
@media (max-width: 480px) {
  .nav-sections button { padding:9px 10px; }
  .nav-sections button .lbl { display: none; }
  .nav-sections button { justify-content: center; }
  .user-box .u-email { font-size: .65rem; }
  .panel-header h1 { font-size:1.05rem; }
}
@media (max-width: 520px) {
  .nav-sections button { font-size:.7rem; padding:8px 10px; }
  .logout-btn-full { padding:10px 14px; font-size:.65rem; }
  .panel-header h1 { font-size:1.25rem; }
  .generic-list li { padding:10px 14px 12px; }
}

.dashboard-container {
  width: 100%;
  max-width: 1200px;
  margin: 40px auto 80px;
  padding: 0 32px;
  display: flex;
  flex-direction: column;
  gap: 32px;
  color: #fff;
}

.dashboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  h1 {
    margin: 0;
    font-size: 2.2rem;
    letter-spacing: .5px;
  }
}

.user-chip {
  display: flex;
  gap: 12px;
  align-items: center;
  background: rgba(255,255,255,0.07);
  padding: 10px 18px;
  border-radius: 40px;
  backdrop-filter: blur(4px);
  .user-email {
    font-weight: 500;
  }
  .role {
    background: #0063cc;
    padding: 4px 10px;
    border-radius: 14px;
    font-size: .75rem;
    text-transform: uppercase;
    letter-spacing: .5px;
  }
  .logout-btn {
    background: #c62828;
    border: none;
    color: #fff;
    padding: 6px 14px;
    border-radius: 20px;
    cursor: pointer;
    font-size: .8rem;
    transition: background .2s;
    &:hover {
      background: #e53935;
    }
  }
}

.cards-grid {
  display: grid;
  gap: 24px;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
}

.card {
  background: linear-gradient(145deg,#15213d,#460270 90%);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 18px;
  padding: 22px 22px 26px;
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 14px;
  box-shadow: 0 8px 18px -6px rgba(0,0,0,0.45);
  h2 {
    margin: 0;
    font-size: 1.15rem;
    letter-spacing: .5px;
  }
  p {
    margin: 0;
    line-height: 1.4;
    font-size: .9rem;
  }
  .mini-info {
    list-style: none;
    padding: 0;
    margin: 4px 0 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 1rem;
    opacity: .9;
    li {
      word-break: break-all;
    }
  }
  .action-btn {
    background: #00aced;
    border: none;
    color: #fff;
    padding: 10px 14px;
    border-radius: 10px;
    cursor: pointer;
    font-size: .8rem;
    font-weight: 600;
    letter-spacing: .5px;
    transition: background .2s, transform .15s;
    &:hover {
      background: #0696cb;
      transform: translateY(-2px);
    }
    &:active {
      transform: translateY(0);
    }
    & + .action-btn {
      margin-top: 8px;
    }
  }
}

.raw-token {
  details {
    background: rgba(255,255,255,0.05);
    padding: 16px 20px;
    border-radius: 14px;
    summary {
      cursor: pointer;
      font-weight: 600;
      outline: none;
    }
    pre {
      margin-top: 14px;
      max-height: 260px;
      overflow: auto;
      background: rgba(0,0,0,0.35);
      padding: 14px;
      border-radius: 10px;
      font-size: .7rem;
      line-height: 1.25;
    }
  }
}

@media (max-width: 640px) {
  .dashboard-container {
    padding: 0 18px;
    margin-top: 24px;
  }
  .dashboard-header h1 {
    font-size: 1.7rem;
  }
  .user-chip {
    margin-top: 12px;
    flex-wrap: wrap;
    justify-content: center;
  }
}

// ==========================
// Modal (CRUD users)
// ==========================
// --- Modal layout amélioré (évite chevauchement header + meilleure responsivité) ---
// Modal overlay : ajouté plus d'espace top pour éviter recouvrement par le header global
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  backdrop-filter: blur(2px);
  display: flex;
  align-items: flex-start;
  justify-content: center;
  /* Plus de marge sous le header (augmenté) */
  padding: max(calc(var(--global-header-height, 70px) + 80px), 140px) 22px 42px;
  z-index: 400; /* > header */
  overflow: auto;
  box-sizing: border-box;
}
.modal {
  width: 100%;
  max-width: 560px;
  background: #ffffff;
  border: 1px solid #d9e2ec;
  border-radius: 18px;
  box-shadow: 0 20px 50px -12px rgba(0,0,0,.35);
  display: flex;
  flex-direction: column;
  /* Hauteur max visible sans passer sous le header ni sortir de l'écran */
  max-height: calc(100vh - (var(--global-header-height, 70px) + 80px));
  overflow: hidden; /* on gère le scroll interne */
  position: relative;
}

/* Header sticky pour garder actions visibles lors du scroll */
.modal-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 18px 22px 12px;
  border-bottom: 1px solid #edf2f7;
  position: sticky;
  top: 0;
  background: #fff;
  z-index: 5;
}

.modal-head h3 {
    margin: 0;
    font-size: 1rem;
    font-family: 'Montserrat', sans-serif;
    letter-spacing: .5px;
}

.modal-head .close-x {
    background: #fff;
    border: 1px solid #cfd8e2;
    width: 34px;
    height: 34px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background .2s, transform .18s;
}

.modal-head .close-x:hover {
    background: #f2f6fa;
    transform: translateY(-2px);
}

/* Zone scrollable */
.modal-form {
  padding: 18px 22px 26px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  font-size: .75rem;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

/* Apaiser les scrollbars */
.modal-form::-webkit-scrollbar { width: 10px; }
.modal-form::-webkit-scrollbar-track { background: transparent; }
.modal-form::-webkit-scrollbar-thumb { background: #d1dae2; border-radius: 5px; }
.modal-form::-webkit-scrollbar-thumb:hover { background: #c2ccd6; }

.modal-form .form-row {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.modal-form label {
    font-weight: 600;
    font-size: .63rem;
    text-transform: uppercase;
    letter-spacing: .6px;
    color: #2a3c50;
}

.modal-form input,
.modal-form select {
    border: 1px solid #cfd8e2;
    border-radius: 10px;
    padding: 10px 12px;
    font-size: .75rem;
    font-family: 'Open Sans', sans-serif;
    background: #fff;
    transition: border .2s, box-shadow .2s;
}

.modal-form input:focus,
.modal-form select:focus {
    outline: none;
    border-color: #709bff;
    box-shadow: 0 0 0 2px rgba(80, 130, 255, .25);
}

.form-row-inline {
    display: flex;
    gap: 14px;
}

.form-row-inline>div {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.modal-actions {
    margin-top: 4px;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.form-error {
    background: #ffe6e2;
    border: 1px solid #ffc1b8;
    color: #b52618;
    padding: 10px 12px;
    font-size: .63rem;
    border-radius: 10px;
}

@media (max-width: 680px) {
  .modal-overlay { padding: calc(var(--global-header-height, 64px) + 60px) 14px 40px; }
  .modal { max-width: 100%; border-radius: 16px; max-height: calc(100vh - (var(--global-header-height, 64px) + 48px)); }
  .modal-form { padding: 16px 18px 22px; }
  .modal-head { padding: 16px 18px 10px; }
  .modal-head h3 { font-size: .95rem; }
}
@media (max-width:560px) {
  .form-row-inline { flex-direction: column; }
}
@media (max-width:430px) {
  .modal-head h3 { font-size: .9rem; }
  .modal-form label { font-size: .6rem; }
  .modal-form input, .modal-form select, .modal-form textarea { font-size: .7rem; padding: 9px 11px; }
}

   .pdf-export {
    .panel-content {
      background: #ffffff !important;
    }
  
    .panel-content *,
    .sidebar-overlay {
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
      filter: none !important;
      text-shadow: none !important;
    }
  
    .overview-grid .card,
    .card {
      background: #ffffff !important;
      color: #1d2a3b !important;
      border: 1px solid #e5e7eb !important;
      box-shadow: none !important;
    }
  
    .overview-grid .card::before,
    .overview-grid .card::after,
    .panel-content .card::before,
    .panel-content .card::after,
    .overview-loading .card::after {
      display: none !important;
    }

    .overview-grid .count-pill {
      background: #ffffff !important;
      border-color: #e5e7eb !important;
      box-shadow: none !important;
    }
    .overview-grid .kv-list li {
      background: #f6f8fb !important;
    }

    .table-scroll {
      background: #ffffff !important;
      border-color: #e5e7eb !important;
      box-shadow: none !important;
    }
    .recharts-default-tooltip { display: none !important; }
  }
  